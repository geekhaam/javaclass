package com.jdbc.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

import com.jdbc.dbconn.TelInfoDBConn;
import com.jdbc.vo.TelInfoVO;

public class TelInfoDAO {
	private Connection conn;
	PreparedStatement pstmt;
	ResultSet rs;
	
	public TelInfoDAO() throws ClassNotFoundException, SQLException {
		conn = new TelInfoDBConn().getConnection();
	}
	
	//전체 출력 메소드 getAllInfo() (Select All)
	//VO와 연결하여 사용한다.
	public ArrayList<TelInfoVO> getAllInfo() throws SQLException {
		ArrayList<TelInfoVO> telInfoList = new ArrayList<TelInfoVO>();
		
		String sql = "SELECT * FROM teltable5 ORDER BY id";
		
		pstmt = conn.prepareStatement(sql);	
		rs = pstmt.executeQuery();
		while(rs.next()) {
			TelInfoVO telInfo = new TelInfoVO(rs.getInt("id"), rs.getString("name"),
					rs.getString("tel"), rs.getDate("d"));
			telInfoList.add(telInfo);
		} return telInfoList;
	}
	
	//이름을 파라미터로 받아 수정
	public boolean update_nametel(String prevName, String modName) throws SQLException {
		String sql = "UPDATE teltable5 SET name=? WHERE name=?";
		
		pstmt = conn.prepareStatement(sql);
		pstmt.setString(1, modName);
		pstmt.setString(2, prevName);
		
		if(pstmt.executeUpdate()==0) {
			return false;
		} else {
			conn.commit();
			return true;
		}
	}
}
